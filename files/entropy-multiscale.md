## エントロピー
脳機能の解析はなにも位相、振幅だけではありません。ここではエントロピーについて解説します。使うソフトはneurokit2です。

```sh
pip install neurokit2
```

僕はエントロピーの専門家じゃないので数学はわかりません！なので、Sample entropyのみ解説します。ちなみに、Sample entropyは自己相似の要素を排したエントロピーとのことです。なるほど、わからん。
ただ、これでスカラー値が出てきますから素敵です。

### Sample entropyのアルゴリズム

- まず、ある長さdの波を切りだしてきます。
- そんで、その波と似ている波を波全体で数えます。
  + 似ているというのは、設定した許容誤差未満のものです。
- 上記についてある長さdとある長さd+1を準備します。
- ある長さdの方を$f(d)$、$f(d+1)$としましょう。
- $ln(f(d+1)/f(d))$がサンプルエントロピーです！

ここで、ある数dとは次元と言われています。何故次元なのか僕はよくわかりません。

### マルチスケール化
上記のサンプルエントロピーはスケール1のエントロピーです。
ある長さdの波を切りだすときの切り方がスケールによってかわります。
ある長さdの波といっても、サンプリング周波数があるはずです。
サンプル一つ一つを、一つ飛びでサンプルして
長さdの波を切りとればスケール2のエントロピーです。
サンプル一つ一つを、二つ飛びでサンプルして
長さdの波を切りとればスケール3のエントロピーです。
以下、無限に同文。

そうやって、いくつものスケールのエントロピーを計算できます。はい、マルチスケールエントロピーです。これはneurokit2を使えばできます。例えばこうです。

```python
from neurokit2.complexity.entropy_multiscale import entropy_multiscale
epochs = read_epochs(epochs_fname).pick_types(eeg=True)
data = epochs.get_data()
data = np.transpose(data, (1, 0, 2))
low, high = 5, 10
result = entropy_multiscale(
    data[0][0],
    scale=list(range(high, low)),
    dimension=5,
    fuzzy=fuzzy
)[0]
```

ね、簡単でしょ？
ここで、fuzzyとか出てきていますが、fuzzy付きのアルゴリズムにすると計算が安定します。結果以外にも色々な情報を吐いてくれるのですが、僕は結果にしか興味がなかったので出力結果の1番目だけ取得しています。

### scaleはどうすればいいのか
分りません><
いや、ほんとに分らないので困るのです。先行研究に習うというのはいいのですが、このアルゴリズムではサンプリング周波数の影響をもろに受けます。はじめからサンプリング周波数をあわせるか、リサンプリングするかしたほうがいいですね。

### 次元はどうすればいいのか
先行研究では2や3が多いです。ですが、これは計算して出す事もできます。

neurokit2.complexity_dimensionを使えば計算できます。例えば、こんな感じです。
結構重いので並列化しましょう。

```python
dm = []
for ep in epochs.pick_types(eeg=True):
     with Pool(19) as p:
         dm.append([n[0] for n in p.map(complexity_dimension, ep)])
```

僕がこれを使ったときに「5にしろ」ってなってしまいました。困ったなぁ。
