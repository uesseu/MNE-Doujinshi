\newpage
## 割り算を極める➗

こんにちは。このセクションは一つ前のセクションで、
言っていることが何も分からなかった友達に特別支援をするための所です。
君たちが分からなかったのは何かな？
君たちが分からなかったのは割り算だ！というわけで…

今回は ~~多変量解析~~   ~~一般線形モデル~~   ~~古典的機械学習~~
**割り算**の話をします。

早速ですが、割り算とは、例えば下記の式です。

$$ \frac{10}{2} = 5 $$

逆元(1/X)を掛けることと等価です。

$$10 \times \frac{1}{2} = 5$$

何の変哲もない割り算ですが、これを極めると、
様々な応用が効くようになります。(多変量解析・逆問題)
例えば、鶴亀算は紛れもなく割り算なのであります。

### 鶴亀算とは連立一次方程式である🐦🐢
鶴亀算とはこの様な問題です🐦🐢

> 鶴と亀の脚の本数の合計は10、個体数を4とします。
> 鶴と亀はそれぞれ何匹ずつ居るでしょうか？

この問題は、小学校中学年がよく悩む問題です。[^sedai]
そして、実は簡単な連立方程式で表わせます。鶴をx匹、亀をy匹とすると以下のとおりです。[^chu]

[^chu]: ここまでが中学数学の範囲

[^sedai]: ただし、世代による

$2x + 4y = 10$
$x + y = 4$

上が足の数、下が躰の数です。

\newpage

### 連立一次方程式とは行列の割り算である➗
上記の2つの式ですが、この様に変形できます。
(ここで、仮に足の数を本、体の数を体の単位で表してみます)
$$ \left(\begin{array}{rr} 2本 & 4本 \\\
 1体 & 1体  \end{array}\right) 
\left(\begin{array}{r} x匹 \\\
 y匹 \end{array}\right) = 
\left(\begin{array}{r} 10本 \\\
 4体 \end{array}\right)$$

横から縦に掛けるからそうなるのは実際に計算すれば分かると思います。

### 鶴亀算の高級な解き方🚗
小学生には小学生なりの解き方がありますが、応用を利かすために大学生らしい解き方をします。
鶴亀算の式が上記のように行列で表現できるならば、逆行列を使うことで解を得られます。
ここで、上記の式を以下のように表してみます。

$$A= \left(\begin{array}{rr} 2本 & 4本 \\\
 1体 & 1体  \end{array}\right) $$

$$X= \left(\begin{array}{r} x匹 \\\
 y匹 \end{array}\right) $$

$$Y=\left(\begin{array}{r} 10本 \\\
 4体 \end{array}\right)$$

$$AX=Y$$
逆行列を用いて
$$X = A^{-1}Y$$

これでXを計算できます。なんと、鶴亀算とは行列の割り算のことでした🐢
ちなみに、これは鶴てんとう虫算とか亀てんとう虫算とかも成立するのですが、
蛇鶴算とか亀猫算は成立しません😺０本足や足の数が同じお友達が入ると難しいのですね🐍
このやり方なら、方程式をコンピュータに自動的に解かせる事が出来ます。

### 実装(python🐍)

では逆行列を作りましょう!今回はプログラミング言語python🐍のnumpyパッケージを使います。
まずは、pythonで割り算のパッケージに、上の行列を入れ込みます。(足と体の数は適当)

```python
from numpy import linalg, array
A = [[2, 4], [1, 1]]  # それぞれ足と首の数
At = linalg.inv(A)  # 逆行列
Y = array([10, 3])  # 足が10本、首が3本
```

逆行列($A^{-1}$)が出来たので、あとは「逆元を掛ける」と解が出ます。

```python
At @ Y  # 逆行列の掛け算
>>> array([1., 2.])
```
答えは鶴1匹と亀2匹ですね。(ここまでが高校数学の範囲)

### 鶴亀てんとう虫算🐤🐢🐞
鶴亀算が出来たので、次は鶴亀てんとう虫算をやってみましょう。
項目を増やしていけば「鶴亀てんとう虫蜘蛛ムカデ」算が出来るようになり、
非常に応用の幅が広がりそうです。(大学数学の範囲)🐤🐢🐞🐜🐛

さて、鶴亀てんとう虫算は下記のような形をしているはずです。
(もういいかなと思うので単位は省略します)

$$ \left(\begin{array}{rrr} 2 & 4 & 6\\\
 1 & 1 & 1 \end{array}\right) 
\left(\begin{array}{r} x \\\
 y  \\\
 z \end{array}\right)= 
\left(\begin{array}{r} a \\\
 b \end{array}\right)$$

### 無限個の解とその解決策∞
実は、鶴亀てんとう虫算は小学校中学校の正攻法では解くことが出来ません。
亀が増えても減っても鶴とてんとう虫で調整できてしまうから、 答えが一つに決まらないのです。[^mugen]

では、どういう条件なら解があるのでしょうか？
鶴、亀、てんとう虫と、三種類の動物の数を調べるなら、
足と首の数だけじゃ決まりません。3つの解には3つの式が必要なのです。

鶴亀てんとう虫算にはもう一つの値、羽の数が必要だったのですね🐞
では、それでやってみましょう！[^hae]

[^mugen]: 無限個の解が存在します。
[^hae]: ちなみに、羽が二枚の昆虫はハエとアブと蚊だけです。可愛い虫には羽がたいてい4枚あります。

$$ \left(\begin{array}{rrr} 2 & 4 & 6\\\
 1 & 1 & 1\\\
 2 & 0 & 4\end{array}\right) 
\left(\begin{array}{r} x \\\
 y  \\\
 z \end{array}\right)= 
\left(\begin{array}{r} a \\\
 b \\\
 c \end{array}\right)$$

```python
from numpy import linalg, array
A = array([[2, 4, 6], [1, 1, 1], [2, 0, 4]])
At = linalg.inv(A)
Y = array([10, 4, 6])
At @ Y

>>> array([ 3., 1.,  0.])
```

計算できました。

### 逆行列は作れないこともある🐍
適当にさっきの行列を弄ってみましょう。

```python
from numpy import linalg, array
A = array([[2, 4, 6], [1, 1, 1], [0, 2, 4]])
At = linalg.inv(A)
>>> LinAlgError: Singular matrix
```
エラーが出ました！💀この行列では逆行列は作れないのでした！こういうこともあります。
うまくいくかどうかの条件はありますが、今回は難しい数学はしません。[^gyore]

[^gyore]: 実は、この条件を求めるのは難しいだけじゃなくて僕にとって退屈な作業です。ちなみに、高校数学の範囲内です。

\newpage
### 疑似逆行列👻
足の数と首の数しか無いときは、答えがないので推定するしかありません。
よく使われる方法は$X$のL2ノルム[^L2norm]が最も小さくなる解を仮の解とする方法です。
無理やり上記の$AX=Y$を$X=A^\dagger Y$の形にしてしまいます。
これは疑似逆行列と言います。[^mo]便利ですね！では実装してみます。

```python
from numpy import linalg, array
A = [[2, 4, 6], [1, 1, 1]]  # 足と首の数
At = linalg.pinv(A)  # 擬似逆行列
Y = array([10, 3])  # 足10本と首3本
At @ Y  # 擬似逆行列の掛け算

>>> array([1.5, 1. , 0.5])
```

[^mo]: 別名、ムーアペンローズの逆行列

適当に数を決めたら少数が出てきました👻
この割り算は、実は色々なパターンがあるのですが、
代表的なパターンとしては、例えば下記があります。
$$X = (A^TA)^{-1}A^TY$$

[^L2norm]: 数学で言う、大きさの種類の一つ。全ての要素の二乗の合計のルートを取ったもの。

## ここまでで学んだ割り算の応用✏

- 花の色や大きさから花の種類を推定する(アヤメ分類問題)
- fMRIや脳波・脳磁計による脳内活動の推定(SPM/MNE)
- 多変量解析を用いた研究
- 以下、無限の応用...

カーネル法(極めて強烈な掛け算。本が一冊かける。)を応用すれば、
なんと無限次連立方程式すら解くことが可能！[^svm]

[^svm]: カーネル法を用いたこの方法はサポートベクトルマシンやカーネルPCAと言われる分類器に応用された。これは一世代前の最も成功した人工知能である。

\newpage
### 具体的な応用 多変量解析入門
では、多変量解析に入門してみましょう！しかし、最早入門も終わったも同然です。
ある集団の平均寿命をY(89, 67, 54, 94, 75...)とします。
一人ひとりの飲酒量A1(1, 2, 4, 0, 0...)
一人ひとりの喫煙量A2(0, 10, 20, 0, 10...)
一人ひとりの1日の歩数A3(4000, 7000, 1500, 2000, 3000...)
として集め、(A1, A2, A3)とし、一寸変形します。(転置)
そして、それぞれの生命予後への寄与率をX(a, b, c)とし、式にします。[^exam]
最後に、それぞれの計算でどうしても出てくる誤差をEとします。

[^exam]: ここでは数値はあくまで例なので適当です)

$$ \left(\begin{array}{rrr}
1 & 0  & 4000\\\
2 & 10 & 7000\\\
4 & 20 & 1500\\\
0 & 0  & 2000\\\
0 & 10 & 3000 \end{array}\right) 
\left(\begin{array}{r} a\\\
 b\\\
 c\end{array}\right)= 
\left(\begin{array}{r}
89\\\
67\\\
54\\\
94\\\
75\end{array}\right) + E$$
$$AX = Y + E$$
ここで、計算の誤差を最小にするXを考えます。
具体的にはEの絶対値が一番小さい時が都合いいです。
$$|AX - Y| = |E|$$
つまりEが0に近い時[^zero]こそがXの最適解なので、下記に近似させればいいです。
$$AX - Y = 0$$

なんと！あからさまに割り算です。なので、コンピュータに解かせられます。
実際は微妙に違うのですが、大まかな理解の一歩としては遠くないはずです。[^kai]

[^zero]: 完全に0にはならないけれど
[^kai]: これには、もうちょっと考えるべきことが入りますが、解や式自体は全く同じになります。

\newpage

### まとめ
- 鶴亀算(連立方程式の一種)とは他ならぬ割り算であった
- 割り算はコンピュータで解くことが出来る
- 割り算を応用することで様々なことが分かる(医学への応用も多数)

### さいごに
君がしている割り算…それを圧倒的に高めたものがeLORETA。
